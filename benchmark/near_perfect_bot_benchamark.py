#  72809682 function calls (72666066 primitive calls) in 81.256 seconds
#
#  Ordered by: internal time
#  List reduced from 152 to 91 due to restriction <0.6>
#
#  ncalls  tottime  percall  cumtime  percall filename:lineno(function)
#  34903   27.341    0.001   27.341    0.001 F:\Programs\Python\Tetris\agents\near_perfect_bot.py:36(GetHoles)
#  349030    9.701    0.000    9.769    0.000 F:\Programs\Python\Tetris\agents\near_perfect_bot.py:24(GetColHeight)
#  1605655    8.129    0.000   25.530    0.000 F:\Programs\Python\Tetris\game_client.py:783(CheckValidity)
#  2472803    3.823    0.000   11.387    0.000 C:\Python39\lib\copy.py:66(copy)
#  1927437    3.361    0.000    3.361    0.000 {method 'reduce' of 'numpy.ufunc' objects}
#  2472057    2.147    0.000    4.254    0.000 C:\Python39\lib\copy.py:258(_reconstruct)
#  1927437    2.062    0.000    6.207    0.000 C:\Python39\lib\site-packages\numpy\core\fromnumeric.py:69(_wrapreduction)
#  1000    1.968    0.002   34.304    0.034 F:\Programs\Python\Tetris\agents\agent.py:138(GetAllPossiblePositions)
#  2325390/2181778    1.609    0.000   10.386    0.000 {built-in method numpy.core._multiarray_umath.implement_array_function}
#  1781825    1.289    0.000    6.768    0.000 C:\Python39\lib\site-packages\numpy\core\fromnumeric.py:2367(all)
#  5052823    1.248    0.000    1.248    0.000 {built-in method builtins.getattr}
#  2472057    1.143    0.000    1.143    0.000 {method '__reduce_ex__' of 'object' objects}
#  1711778    1.119    0.000    1.119    0.000 {method 'astype' of 'numpy.ndarray' objects}
#  1781825    1.021    0.000    8.951    0.000 <__array_function__ internals>:2(all)
#  35903    0.953    0.000    2.355    0.000 F:\Programs\Python\Tetris\game_client.py:603(_PrePutPiece)
#  2359094    0.900    0.000   11.649    0.000 F:\Programs\Python\Tetris\shape.py:190(copy)
#  2472057    0.671    0.000    0.964    0.000 C:\Python39\lib\copyreg.py:90(__newobj__)
#  2472057    0.663    0.000    0.663    0.000 {method 'update' of 'dict' objects}
#  143612    0.606    0.000    0.674    0.000 F:\Programs\Python\Tetris\game_client.py:292(SetMap)
#  35903    0.579    0.000    3.255    0.000 F:\Programs\Python\Tetris\game_client.py:557(_LineClear)
#  5641961    0.575    0.000    0.575    0.000 {built-in method builtins.isinstance}
#  105568    0.539    0.000    4.253    0.000 F:\Programs\Python\Tetris\game_client.py:661(_FindFittedPiece)
#  71806    0.520    0.000    0.971    0.000 C:\Python39\lib\site-packages\numpy\lib\function_base.py:4382(delete)
#  1927437    0.515    0.000    0.515    0.000 C:\Python39\lib\site-packages\numpy\core\fromnumeric.py:70(<dictcomp>)
#  326470    0.510    0.000    1.417    0.000 C:\Python39\lib\queue.py:122(put)
#  652940    0.475    0.000    0.795    0.000 C:\Python39\lib\threading.py:351(notify)
#  326470    0.468    0.000    1.286    0.000 C:\Python39\lib\queue.py:154(get)
#  4944860    0.429    0.000    0.429    0.000 {method 'get' of 'dict' objects}
#  1000    0.392    0.000   80.289    0.080 F:\Programs\Python\Tetris\agents\near_perfect_bot.py:50(FindBestMove)
#  1605655    0.383    0.000    0.383    0.000 F:\Programs\Python\Tetris\shape.py:157(GetBitMap)
#  122514    0.352    0.000    6.342    0.000 F:\Programs\Python\Tetris\game_client.py:764(Rotate)
#  2472057    0.293    0.000    0.293    0.000 {built-in method __new__ of type object at 0x00007FF8D1435C60}
#  2507970    0.276    0.000    0.276    0.000 {built-in method builtins.hasattr}
#  369568    0.270    0.000    6.296    0.000 F:\Programs\Python\Tetris\agents\agent.py:42(_AtBottom)
#  2472057    0.258    0.000    0.258    0.000 {built-in method builtins.issubclass}
#  327470    0.254    0.000    0.410    0.000 C:\Python39\lib\queue.py:97(empty)
#  1781825    0.247    0.000    0.247    0.000 C:\Python39\lib\site-packages\numpy\core\fromnumeric.py:2362(_all_dispatcher)
#  1927437    0.221    0.000    0.221    0.000 {method 'items' of 'dict' objects}
#  652940    0.199    0.000    0.325    0.000 C:\Python39\lib\threading.py:256(__enter__)
#  652940    0.186    0.000    0.320    0.000 C:\Python39\lib\threading.py:271(_is_owned)
#  34903    0.179    0.000    9.948    0.000 F:\Programs\Python\Tetris\agents\near_perfect_bot.py:73(<listcomp>)
#  652940    0.174    0.000    0.243    0.000 C:\Python39\lib\threading.py:259(__exit__)
#  37903    0.148    0.000    1.317    0.000 F:\Programs\Python\Tetris\game_client.py:334(copy)
#  464891    0.144    0.000    0.144    0.000 F:\Programs\Python\Tetris\actions.py:12(__init__)
#  653940    0.144    0.000    0.207    0.000 C:\Python39\lib\queue.py:209(_qsize)
#  670886    0.139    0.000    0.139    0.000 {method 'acquire' of '_thread.lock' objects}
#  1737973    0.135    0.000    0.135    0.000 {built-in method builtins.len}
#  35903    0.130    0.000    0.378    0.000 F:\Programs\Python\Tetris\game_client.py:514(_AnalyzeElimination)
#  652940    0.127    0.000    0.127    0.000 {method '__enter__' of '_thread.lock' objects}
#  36903    0.118    0.000    0.654    0.000 F:\Programs\Python\Tetris\game_client.py:279(GetMapArea)
#  36903    0.116    0.000    0.997    0.000 F:\Programs\Python\Tetris\game_client.py:508(CheckGameOver)
#  105709    0.111    0.000    2.157    0.000 F:\Programs\Python\Tetris\game_client.py:653(SpawnPiece)
#  980410    0.110    0.000    0.110    0.000 {method '__exit__' of '_thread.lock' objects}
#  326470    0.106    0.000    0.146    0.000 C:\Python39\lib\queue.py:213(_put)
#  326470    0.090    0.000    0.123    0.000 C:\Python39\lib\queue.py:217(_get)
#  105568    0.088    0.000    0.120    0.000 F:\Programs\Python\Tetris\game_client.py:671(_IsJLSTZ)
#  143612    0.074    0.000    0.074    0.000 {built-in method numpy.asarray}
#  35903    0.071    0.000    4.332    0.000 F:\Programs\Python\Tetris\game_client.py:629(_PostPutPiece)
#  73806    0.069    0.000    0.450    0.000 C:\Python39\lib\site-packages\numpy\core\fromnumeric.py:2763(amin)
#  75946    0.069    0.000    0.069    0.000 {built-in method numpy.array}
#  143612    0.068    0.000    0.068    0.000 {method 'copy' of 'numpy.ndarray' objects}
#  71806    0.061    0.000    0.280    0.000 C:\Python39\lib\site-packages\numpy\core\numeric.py:149(ones)
#  35903    0.059    0.000    0.081    0.000 C:\Python39\lib\site-packages\numpy\core\shape_base.py:81(atleast_2d)
#  71806    0.059    0.000    0.059    0.000 {built-in method numpy.empty}
#  71806    0.051    0.000    1.094    0.000 <__array_function__ internals>:2(delete)
#  71806    0.049    0.000    0.161    0.000 <__array_function__ internals>:2(copyto)
#  211008    0.048    0.000    0.048    0.000 F:\Programs\Python\Tetris\shape.py:119(Rotate90)
#  17805    0.046    0.000    0.820    0.000 F:\Programs\Python\Tetris\game_client.py:416(Move)
#  35903    0.044    0.000    0.291    0.000 C:\Python39\lib\site-packages\numpy\core\shape_base.py:222(vstack)
#  34903    0.044    0.000    0.275    0.000 C:\Python39\lib\site-packages\numpy\core\fromnumeric.py:2123(sum)
#  71826    0.041    0.000    0.244    0.000 <__array_function__ internals>:2(concatenate)
#  326470    0.039    0.000    0.039    0.000 {method 'append' of 'collections.deque' objects}
#  73806    0.039    0.000    0.536    0.000 <__array_function__ internals>:2(amin)
#  75806    0.037    0.000    0.168    0.000 <__array_function__ internals>:2(copy)
#  326470    0.034    0.000    0.034    0.000 {method 'popleft' of 'collections.deque' objects}
#  35903    0.031    0.000    6.718    0.000 F:\Programs\Python\Tetris\game_client.py:590(PutPiece)
#  184784    0.030    0.000    0.030    0.000 {method 'add' of 'set' objects}
#  36903    0.029    0.000    0.151    0.000 C:\Python39\lib\site-packages\numpy\core\fromnumeric.py:2268(any)
#  35903    0.024    0.000    0.024    0.000 {built-in method numpy.zeros}
#  70547    0.023    0.000    0.024    0.000 F:\Programs\Python\Tetris\game_client.py:476(_RefreshLockTime)
#  34903    0.022    0.000    0.324    0.000 <__array_function__ internals>:2(sum)
#  36903    0.022    0.000    0.226    0.000 <__array_function__ internals>:2(any)
#  35903    0.021    0.000    0.366    0.000 <__array_function__ internals>:2(vstack)
#  34903    0.021    0.000    0.185    0.000 <__array_function__ internals>:2(dot)
#  75806    0.020    0.000    0.088    0.000 C:\Python39\lib\site-packages\numpy\lib\function_base.py:726(copy)
#  35903    0.018    0.000    0.117    0.000 <__array_function__ internals>:2(atleast_2d)
#  35903    0.017    0.000    0.017    0.000 F:\Programs\Python\Tetris\shape.py:154(GetShape)
#  17805    0.015    0.000    0.897    0.000 F:\Programs\Python\Tetris\game_client.py:384(ProcessAction)
#  108590    0.015    0.000    0.015    0.000 {method 'append' of 'list' objects}
#  35903    0.012    0.000    0.034    0.000 C:\Python39\lib\site-packages\numpy\core\shape_base.py:218(_vhstack_dispatcher)
#  1028    0.012    0.000    0.012    0.000 {built-in method builtins.print}
#
#
#
#  Process finished with exit code 0
#
import cProfile
import pstats

from benchmark import utils
from agents import agent
from agents import near_perfect_bot

def RunAgent(n_games=20, n_moves=50):
  games = utils.GenRandomGames(n_games, random_blocks=20, last_n_lines=6)
  for game in games:
    env = agent.Env(game=game)
    bot = near_perfect_bot.TheNearPerfectAgent(env)
    for i in range(n_moves):
      decision = bot.MakeDecision()
      env.game.ProcessActions(decision)


def RunBenchmark():
  profile = cProfile.Profile()
  profile.runcall(RunAgent)
  stats = pstats.Stats(profile)
  stats.sort_stats("tottime").print_stats(0.6)


if __name__ == "__main__":
  RunBenchmark()
